

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Attendance and muddiest point compilation &mdash; pl-cee202-docs 0.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Markdown Introduction" href="../web/markdown_intro.html" />
    <link rel="prev" title="Grade Transfer from PL to Compass" href="grade_for_compass2g.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> pl-cee202-docs
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Students</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../student/student_login.html">How to Access PrairieLearn?</a></li>
</ul>
<p class="caption"><span class="caption-text">Instructors/TAs</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="setup.html">How to Run PrairieLearn?</a></li>
<li class="toctree-l1"><a class="reference internal" href="num-R.html">Numerical Answers with R</a></li>
<li class="toctree-l1"><a class="reference internal" href="num-Python.html">Numerical Answers with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiple-choice.html">Multiple Choice</a></li>
<li class="toctree-l1"><a class="reference internal" href="checkbox.html">Checkbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="r_autograder.html">Another example question R autograder</a></li>
<li class="toctree-l1"><a class="reference internal" href="topics_tags.html">List of Topics and Tags</a></li>
<li class="toctree-l1"><a class="reference internal" href="grade_for_compass2g.html">Grade Transfer from PL to Compass</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Attendance and muddiest point compilation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#summary">Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-code">Running the code</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Website Developers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../web/markdown_intro.html">Markdown Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../web/maintain_site.html">Maintain Website</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pl-cee202-docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Attendance and muddiest point compilation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/page/instructor_TA/Attendance_muddiest_point.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="attendance-and-muddiest-point-compilation">
<h1>Attendance and muddiest point compilation<a class="headerlink" href="#attendance-and-muddiest-point-compilation" title="Permalink to this headline">¶</a></h1>
<p>By Neetesh Sharma</p>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>This is simple python script, which is written to compile data collected by responses from the team based class attendance form and the muddiest point question. The script works with these specific questions and the way prairie learn output csv files look like. The code is hacky and not particularly clean or efficient but anyone with basic idea of file manipulation and scripting in python should be able to read and edit to make it work with different problems.</p>
</div>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>In this section I will just go through the different parts of the script and give brief descriptions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Tue Jan 28 14:41:03 2020</span>

<span class="sd">@author: nsharm11@illinois.edu</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">Levenshtein</span> <span class="k">as</span> <span class="nn">lv</span>
</pre></div>
</div>
<p>Importing the libraries.</p>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Pandas</span></code> for manipulating data in dataframes and input output of csv.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Numpy</span></code> for some basic array functions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Glob</span></code> to collect files from the student file submission directory</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Levenshtein</span></code> to calculate the string similarity with input student names and student names in roster to detect and correct spelling mistakes by students in filling their names</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">###########################</span>
<span class="c1">###### Inputs #############</span>
<span class="c1">###########################</span>
<span class="n">rosterpath</span> <span class="o">=</span> <span class="s2">&quot;roster3-25-20.csv&quot;</span>
<span class="n">filespath</span> <span class="o">=</span> <span class="s2">&quot;Worksheet22/*.txt&quot;</span>
<span class="n">scorepath</span> <span class="o">=</span> <span class="s2">&quot;CEE_202_SPRING2020_WS22_scores_by_username.csv&quot;</span>
<span class="n">max_score</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">att_outfile</span> <span class="o">=</span> <span class="s2">&quot;Attendance_WS_compiled_WS22.csv&quot;</span>
<span class="n">mp_outfile</span> <span class="o">=</span> <span class="s2">&quot;Muddiest_point_compiled_WS22.csv&quot;</span>
<span class="n">date</span> <span class="o">=</span> <span class="s2">&quot;apr30&quot;</span>
</pre></div>
</div>
<p>Now we move on to the inputs.</p>
<ol>
<li><p><code class="docutils literal notranslate"><span class="pre">roster3-25-20.csv</span></code> is the class roster with the following format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">team</span><span class="p">,</span><span class="n">last</span><span class="p">,</span><span class="n">first</span><span class="p">,</span><span class="n">netid</span>
<span class="n">Team_1</span><span class="p">,</span><span class="n">Bellary</span><span class="p">,</span><span class="n">Amritha</span><span class="p">,</span><span class="n">abella8</span>
<span class="n">Team_1</span><span class="p">,</span><span class="n">Barbieri</span><span class="p">,</span><span class="n">Giulia</span><span class="p">,</span><span class="n">gbarbier</span>
<span class="n">Team_1</span><span class="p">,</span><span class="n">Osei</span><span class="p">,</span><span class="n">Kweku</span><span class="p">,</span><span class="n">kosei2</span>
<span class="n">Team_1</span><span class="p">,</span><span class="n">Wiggins</span><span class="p">,</span><span class="n">Robert</span><span class="p">,</span><span class="n">rjw5</span>
<span class="n">Team_2</span><span class="p">,</span><span class="n">Nguyen</span><span class="p">,</span><span class="n">Chris</span><span class="p">,</span><span class="n">cnguye52</span>
<span class="n">Team_2</span><span class="p">,</span><span class="n">Ambrosino</span><span class="p">,</span><span class="n">Jack</span><span class="p">,</span><span class="n">jackaa2</span>
<span class="n">Team_2</span><span class="p">,</span><span class="n">Salam</span><span class="p">,</span><span class="n">Shaadmaan</span><span class="p">,</span><span class="n">sfsalam2</span>
</pre></div>
</div>
</li>
<li><p>filespath is where the “best_files” from PL are located, as obtained from the downloads available on PL</p></li>
<li><p>scorepath is again a csv of scores by username as downloaded from PL</p></li>
<li><p>maxscore is the maximum score in the assessment from the above file (Note that in the current class policy <code class="docutils literal notranslate"><span class="pre">&gt;=50%</span></code> of the max score earns <code class="docutils literal notranslate"><span class="pre">100</span></code> points and zero otherwise)</p></li>
<li><p>Then there are the preferred names of the outputs and the date of the worksheet being processed</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read the roster and make all possible mapping dicts for convenience</span>
    
<span class="n">roster</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">rosterpath</span><span class="p">)</span>
<span class="n">roster</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">roster</span><span class="p">[</span><span class="s1">&#39;last&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">roster</span><span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">])</span>
<span class="n">roster</span><span class="p">[</span><span class="s1">&#39;name1&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">roster</span><span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">roster</span><span class="p">[</span><span class="s1">&#39;last&#39;</span><span class="p">])</span>
<span class="n">roster</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">isalnum</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">roster</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span>
<span class="n">roster</span><span class="p">[</span><span class="s1">&#39;name1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">isalnum</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">roster</span><span class="p">[</span><span class="s1">&#39;name1&#39;</span><span class="p">]]</span>
<span class="n">roster</span><span class="p">[</span><span class="s1">&#39;att&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">roster</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">roster</span><span class="p">[</span><span class="s1">&#39;submitting_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">roster</span><span class="p">[</span><span class="s1">&#39;check&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">nametoid</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">idtoname</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">idtoteam</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">roster</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="n">nametoid</span><span class="p">[</span><span class="n">roster</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]]</span><span class="o">=</span> <span class="n">roster</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;netid&#39;</span><span class="p">]</span>
    <span class="n">nametoid</span><span class="p">[</span><span class="n">roster</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;name1&#39;</span><span class="p">]]</span><span class="o">=</span> <span class="n">roster</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;netid&#39;</span><span class="p">]</span>
    <span class="n">idtoname</span><span class="p">[</span><span class="n">roster</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;netid&#39;</span><span class="p">]]</span><span class="o">=</span> <span class="n">roster</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="n">idtoteam</span><span class="p">[</span><span class="n">roster</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;netid&#39;</span><span class="p">]]</span><span class="o">=</span> <span class="n">roster</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">]</span>

<span class="n">teams</span> <span class="o">=</span> <span class="n">roster</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;team&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span>
<span class="n">teamtonames</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">teamtoids</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">teams</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">teamtonames</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">roster</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">teams</span><span class="p">[</span><span class="n">key</span><span class="p">],[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;name1&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">teamtoids</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">roster</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">teams</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="s1">&#39;netid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">roster</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">roster</span><span class="o">.</span><span class="n">netid</span>
</pre></div>
</div>
<p>We then process the roster and make mappings from id to name and name to id, id to team and team to multiple ids. These will be useful for processing the student inputs. Also, the processed <code class="docutils literal notranslate"><span class="pre">roster</span></code> dataframe serves as place to report the attendance and scores, and that is why I add numeric columns for <code class="docutils literal notranslate"><span class="pre">'att',</span> <span class="pre">'score',</span> <span class="pre">'submitting_id'</span></code>, and <code class="docutils literal notranslate"><span class="pre">'check'</span></code> in the roster as place holders.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read submitted files and separate present team member names</span>
    
<span class="n">flist</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">filespath</span><span class="p">)</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">chunks</span><span class="p">(</span><span class="n">filespath</span><span class="p">,</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">flist</span><span class="p">])</span>

<span class="n">qgrp</span><span class="o">=</span><span class="n">df1</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;question&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">groups</span>
<span class="n">dfnames</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qgrp</span><span class="p">[</span><span class="s1">&#39;team_names.txt&#39;</span><span class="p">],:]</span>
<span class="n">dfnames</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">dfnames</span><span class="o">.</span><span class="n">netid</span>
<span class="n">dfnames</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;n2&#39;</span><span class="p">,</span><span class="s1">&#39;n3&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>We then read the submitted files and and extract data from the filename as well as the text inside the files. The function <code class="docutils literal notranslate"><span class="pre">chunks</span></code> performs this procedure for each filename</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">chunks</span><span class="p">(</span><span class="n">filespath</span><span class="p">,</span><span class="n">fname</span><span class="p">):</span>
    <span class="n">allchunks</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">allchunks</span> <span class="o">=</span> <span class="n">allchunks</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
    <span class="n">semail</span> <span class="o">=</span> <span class="n">allchunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1">## CHange teh number to extract netid</span>
    <span class="n">netid</span> <span class="o">=</span> <span class="n">semail</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">allchunks</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;File&#39;</span><span class="p">:</span>
        <span class="n">qname</span> <span class="o">=</span> <span class="n">allchunks</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">allchunks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">allchunks</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">allchunks</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
        <span class="n">n3</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">allchunks</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">qname</span> <span class="o">=</span> <span class="n">allchunks</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">allchunks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">allchunks</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">allchunks</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
        <span class="n">n3</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">allchunks</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file1</span><span class="p">:</span>
        <span class="n">ftxt</span> <span class="o">=</span> <span class="n">file1</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;netid&#39;</span><span class="p">:</span><span class="n">netid</span><span class="p">,</span>
            <span class="s1">&#39;question&#39;</span><span class="p">:</span><span class="n">qname</span><span class="p">,</span>
            <span class="s1">&#39;n1&#39;</span><span class="p">:</span><span class="n">n1</span><span class="p">,</span>
            <span class="s1">&#39;n2&#39;</span><span class="p">:</span><span class="n">n2</span><span class="p">,</span>
            <span class="s1">&#39;n3&#39;</span><span class="p">:</span><span class="n">n3</span><span class="p">,</span>
            <span class="s1">&#39;ftext&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">isalnum</span><span class="p">,</span> <span class="n">ftxt</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;zzz&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;zzz&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;zzz&#39;</span><span class="p">)),</span>
            <span class="s1">&#39;ftext_ue&#39;</span><span class="p">:</span> <span class="n">ftxt</span><span class="p">}</span>
</pre></div>
</div>
<p>This function is the piece which would need editing if the code is to be applied to a different problem, since <code class="docutils literal notranslate"><span class="pre">chunks</span></code> relies on the position of different type of information at different location inside the filename.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read scores</span>
<span class="n">score</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">scorepath</span><span class="p">)</span>
<span class="n">score</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;netid&#39;</span><span class="p">,</span><span class="s1">&#39;raw&#39;</span><span class="p">]</span>
<span class="n">score</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">score</span><span class="p">[</span><span class="s1">&#39;raw&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">max_score</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="n">score</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">score</span><span class="o">.</span><span class="n">netid</span>
<span class="n">score</span> <span class="o">=</span> <span class="n">score</span><span class="o">.</span><span class="n">score</span>
</pre></div>
</div>
<p>We then read the score file as well and create a id to score map.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">checkdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([],</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Typo&#39;</span><span class="p">,</span> <span class="s1">&#39;netid&#39;</span><span class="p">,</span> <span class="s1">&#39;Correct&#39;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">netid</span> <span class="ow">in</span> <span class="n">dfnames</span><span class="p">[</span><span class="s1">&#39;netid&#39;</span><span class="p">]:</span>
    <span class="n">roster</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">netid</span><span class="p">,</span><span class="s1">&#39;att&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">roster</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">netid</span><span class="p">,</span><span class="s1">&#39;submitting_id&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">netid</span>
    <span class="n">roster</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">netid</span><span class="p">,</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">roster</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">netid</span><span class="p">,</span><span class="s1">&#39;score&#39;</span><span class="p">],</span><span class="n">score</span><span class="p">[</span><span class="n">netid</span><span class="p">])</span>
    <span class="n">names</span> <span class="o">=</span> <span class="n">dfnames</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">netid</span><span class="p">,</span><span class="s1">&#39;ftext&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">!=</span><span class="nb">type</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])):</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">names</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">roster</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nametoid</span><span class="p">[</span><span class="n">name</span><span class="p">],</span><span class="s1">&#39;att&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
            <span class="n">roster</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nametoid</span><span class="p">[</span><span class="n">name</span><span class="p">],</span><span class="s1">&#39;submitting_id&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">netid</span>
            <span class="n">roster</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nametoid</span><span class="p">[</span><span class="n">name</span><span class="p">],</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">roster</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nametoid</span><span class="p">[</span><span class="n">name</span><span class="p">],</span><span class="s1">&#39;score&#39;</span><span class="p">],</span><span class="n">score</span><span class="p">[</span><span class="n">netid</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">team</span> <span class="o">=</span> <span class="n">idtoteam</span><span class="p">[</span><span class="n">netid</span><span class="p">]</span>
            <span class="n">candidate_names</span> <span class="o">=</span> <span class="n">teamtonames</span><span class="p">[</span><span class="n">team</span><span class="p">]</span>
            <span class="n">foundflag</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">cn</span> <span class="ow">in</span> <span class="n">candidate_names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lv</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">cn</span><span class="p">,</span><span class="n">name</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">:</span>
                    <span class="n">foundflag</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">roster</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nametoid</span><span class="p">[</span><span class="n">cn</span><span class="p">],</span><span class="s1">&#39;att&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
                    <span class="n">roster</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nametoid</span><span class="p">[</span><span class="n">cn</span><span class="p">],</span><span class="s1">&#39;submitting_id&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">netid</span>
                    <span class="n">roster</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nametoid</span><span class="p">[</span><span class="n">cn</span><span class="p">],</span><span class="s1">&#39;score&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">roster</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nametoid</span><span class="p">[</span><span class="n">cn</span><span class="p">],</span><span class="s1">&#39;score&#39;</span><span class="p">],</span><span class="n">score</span><span class="p">[</span><span class="n">netid</span><span class="p">])</span>
                    <span class="n">roster</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nametoid</span><span class="p">[</span><span class="n">cn</span><span class="p">],</span><span class="s1">&#39;check&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
                    <span class="n">checkdf</span><span class="o">=</span><span class="n">checkdf</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Typo&#39;</span><span class="p">:</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;netid&#39;</span><span class="p">:</span><span class="n">netid</span><span class="p">,</span> <span class="s1">&#39;Correct&#39;</span><span class="p">:</span><span class="n">cn</span><span class="p">},</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">if</span> <span class="n">foundflag</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">checkdf</span><span class="o">=</span><span class="n">checkdf</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Typo&#39;</span><span class="p">:</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;netid&#39;</span><span class="p">:</span><span class="n">netid</span><span class="p">,</span> <span class="s1">&#39;Correct&#39;</span><span class="p">:</span><span class="s1">&#39;Not found&#39;</span><span class="p">},</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>This part of code now gives the attendance to the students listed inside the present team members portion. We first give attendance to the submitting id, we then try to map name to ids using the roster data and if no name to id is found we try to compare with the available ones using the string comparison and try to make corrections. If no correction is found within the search distance, <code class="docutils literal notranslate"><span class="pre">&quot;not</span> <span class="pre">found&quot;</span></code> is reported. We keep track of all the correction we made in a <code class="docutils literal notranslate"><span class="pre">checkdf</span></code> dataframe.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Please check these entries and update for &#39;Not Found&#39; manually </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">checkdf</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">())</span>

<span class="n">outdf</span><span class="o">=</span><span class="n">roster</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;team&#39;</span><span class="p">,</span><span class="s1">&#39;last&#39;</span><span class="p">,</span><span class="s1">&#39;first&#39;</span><span class="p">,</span><span class="s1">&#39;att&#39;</span><span class="p">,</span><span class="s1">&#39;score&#39;</span><span class="p">,</span><span class="s1">&#39;submitting_id&#39;</span><span class="p">]]</span>
<span class="n">outdf</span><span class="o">=</span><span class="n">outdf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;att&#39;</span><span class="p">:</span><span class="s1">&#39;att_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">date</span><span class="p">),</span><span class="s1">&#39;score&#39;</span><span class="p">:</span><span class="s1">&#39;score_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">date</span><span class="p">)})</span>
<span class="n">outdf</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">att_outfile</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">dfmpt</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">qgrp</span><span class="p">[</span><span class="s1">&#39;team_questions.txt&#39;</span><span class="p">],:]</span>
<span class="n">dfmpt</span><span class="p">[</span><span class="s1">&#39;team&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">idtoteam</span><span class="p">[</span><span class="n">netid</span><span class="p">]</span> <span class="k">for</span> <span class="n">netid</span> <span class="ow">in</span> <span class="n">dfmpt</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;netid&#39;</span><span class="p">]]</span>
<span class="n">dfmpt</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;netid&#39;</span><span class="p">,</span><span class="s1">&#39;team&#39;</span><span class="p">,</span><span class="s1">&#39;ftext_ue&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">mp_outfile</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>We then print the corrections we made for a manual check, and then write the output files.</p>
</div>
<div class="section" id="running-the-code">
<h2>Running the code<a class="headerlink" href="#running-the-code" title="Permalink to this headline">¶</a></h2>
<p>Use a GUI such as spyder to run the script. Make sure you are in the relevant working directory and files are in place according to the paths you define in the inputs.</p>
<p>Fill in all the inputs and run the code upto the print out of the <code class="docutils literal notranslate"><span class="pre">checkdf</span></code>.</p>
<p><img alt="../../_images/Capture.PNG" src="../../_images/Capture.PNG" /></p>
<p>Carefully check the printed corrections</p>
<p><img alt="../../_images/check.PNG" src="../../_images/check.PNG" /></p>
<p>If there are some not founds or something the script got wrong, we need to edit the files submitted by the identified student id manually.</p>
<p>Finally run the code for outputs and processing is done.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../web/markdown_intro.html" class="btn btn-neutral float-right" title="Markdown Introduction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="grade_for_compass2g.html" class="btn btn-neutral float-left" title="Grade Transfer from PL to Compass" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Zhonghua Zheng

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>